game:
  arch: win64
  args: --in-process-gpu
  exe: start-humble.cmd
  prefix: /home/keith/Games/humble-games-collection
game_slug: humble-games-collection
name: Humble Games Collection
requires: null
script:
  files:
  - ags: https://www.humblebundle.com/app/download
  game:
    arch: win64
    args: --in-process-gpu
    exe: start-humble.cmd
    prefix: $GAMEDIR
  install_complete_text: 'Installation complete.


    After allowing access from your browser, you should open the link with the "Humble
    Games Collection (Login)" app.'
  installer:
  - task:
      arch: win64
      prefix: /home/keith/Games/humble-games-collection
      wine_path: /home/keith/.local/share/lutris/runners/wine/lutris-7.2-2-x86_64/bin/wine
  - task:
      arch: win64
      args: /S
      env: {}
      exclude_processes: Humble App.exe explorer.exe
      executable: /home/keith/.cache/lutris/installer/humble-games-collection/ags/download
      prefix: /home/keith/Games/humble-games-collection
      wine_path: /home/keith/.local/share/lutris/runners/wine/lutris-7.2-2-x86_64/bin/wine
  - write_file:
      content: '#!/usr/bin/env sh

        set -e

        export LUTRIS_SKIP_INIT=1

        LUTRIS_CMD="lutris:rungame/humble-games-collection"

        FIXED_SCHEME="$(echo "$1" | sed "s/?/\//")"


        echo "$FIXED_SCHEME" > $GAMEDIR/drive_c/.auth

        if command -v lutris 1>/dev/null; then

        lutris $LUTRIS_CMD

        else

        flatpak run net.lutris.Lutris $LUTRIS_CMD

        fi'
      file: $GAMEDIR/handle-humble-scheme
  - chmodx: $GAMEDIR/handle-humble-scheme
  - write_file:
      content: '@echo off

        cd /d "%USERPROFILE%\AppData\Local\Programs\Humble App\"

        set /p Url=<"C:\.auth"

        if defined Url (

        start "" "Humble App.exe" "%Url%"

        del "C:\.auth"

        ) else (

        start "" "Humble App.exe" "%*"

        )'
      file: $GAMEDIR/start-humble.cmd
  - write_file:
      content: '[Desktop Entry]

        Name=Humble Games Collection (Login)

        Comment=Target for handling Humble Games Collection logins. You should not
        run this manually.

        Exec=$GAMEDIR/handle-humble-scheme %u

        Type=Application

        Icon=lutris_humble-games-collection

        MimeType=x-scheme-handler/humble;'
      file: $HOME/.local/share/applications/Humble-scheme-handler.desktop
  wine:
    version: lutris-7.2-2-x86_64
slug: humble-games-collection-windows
variables: {}
version: Windows
wine:
  version: lutris-7.2-2-x86_64
year: 2021
